{% extends "base.html" %}
{% block content %}

<div class="container-fluid dashboard">
  <div class="row mb-4">
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card bg-primary text-white h-100">
        <div class="card-body body1">
          <h5 class="card-title">Total Income</h5>
          <h2 class="card-text" id="totalIncome">Loading...</h2>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card bg-success text-white h-100">
        <div class="card-body body2">
          <h5 class="card-title">Total Expenses</h5>
          <h2 class="card-text" id="totalExpenses">Loading...</h2>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card bg-info text-white h-100">
        <div class="card-body body3">
          <h5 class="card-title">Net Cash Flow</h5>
          <h2 class="card-text" id="netCashFlow">Loading...</h2>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3 mb-3">
      <div class="card bg-warning text-dark h-100">
        <div class="card-body body4">
          <h5 class="card-title">Currency</h5>
          <h2 class="card-text" id="currencySymbol">Loading...</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-5">
    <div class="col-md-7 col-lg-8 border-cashflow">
      <form method="POST" action="{{ url_for('finData.cash_income') }}">
        {{ income_form.hidden_tag() }}
        <div class="row g-3">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary">Income</span>
          </h4>
          <div class="col-sm-6">
            {{ income_form.title_income.label(class="form-control-label") }}
            {% if income_form.title_income.errors %}
              {{ income_form.title_income(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in income_form.title_income.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ income_form.title_income(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="col-sm-6">
            {{ income_form.amount_income.label(class="form-control-label") }}
            {% if income_form.amount_income.errors %}
              {{ income_form.amount_income(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in income_form.amount_income.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ income_form.amount_income(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="col-sm-6">
            {{ income_form.date_income.label(class="form-control-label") }}
            {% if income_form.date_income.errors %}
              {{ income_form.date_income(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in income_form.date_income.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ income_form.date_income(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="input-group">
            {{ income_form.submit_income(class="btn btn-secondary") }}
          </div>
          <hr class="my-4" />
        </div>
      </form>

      <h2>Income Records</h2>
      <div class="table-responsive small">
        <table class="table table-striped table-sm" id="incomeTable">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Income</th>
              <th scope="col">Amount</th>
              <th scope="col">Date</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for income in incomes[:8] %}
            <tr data-income-id="{{ income.id }}">
              <td>{{ loop.index }}</td>
              <td>{{ income.title_income }}</td>
              <td>{{ format_currency(income['amount_income'], income['currency']) }}</td>
              <td>{{ income.date_income }}</td>
              <td>
                <button class="btn btn-danger btn-sm delete-income" data-id="{{ income.id }}">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if incomes|length > 8 %}
        <button class="btn btn-primary" onclick="showAllIncomeRecords()">Show All Records</button>
        {% endif %}
      </div>
    </div>
    <div class="col-md-7 col-lg-8 border-cashflow">
      <form method="POST" action="{{ url_for('finData.cash_income') }}">
        {{ expense_form.hidden_tag() }}
        <div class="row g-3">
          <h2 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary-expenses">Expenses</span>
          </h2>
          <div class="col-sm-6">
            {{ expense_form.title_expense.label(class="form-control-label") }}
            {% if expense_form.title_expense.errors %}
              {{ expense_form.title_expense(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in expense_form.title_expense.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ expense_form.title_expense(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="col-sm-6">
            {{ expense_form.amount_expense.label(class="form-control-label") }}
            {% if expense_form.amount_expense.errors %}
              {{ expense_form.amount_expense(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in expense_form.amount_expense.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ expense_form.amount_expense(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="col-sm-6">
            {{ expense_form.date_expense.label(class="form-control-label") }}
            {% if expense_form.date_expense.errors %}
              {{ expense_form.date_expense(class="form-control form-control-lg is-invalid") }}
              <div class="invalid-feedback">
                {% for error in expense_form.date_expense.errors %}
                  <span>{{ error }}</span>
                {% endfor %}
              </div>
            {% else %}
              {{ expense_form.date_expense(class="form-control form-control-lg") }}
            {% endif %}
          </div>
          <div class="input-group">
            {{ expense_form.submit_expense(class="btn btn-secondary") }}
          </div>
          <hr class="my-4" />
        </div>
      </form>
      <h2>Latest Expenses Records</h2>
      <div class="table-responsive small">
        <table class="table table-striped table-sm" id="expenseTable">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Expense</th>
              <th scope="col">Amount</th>
              <th scope="col">Date</th>
              <th scope="col">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for expense in expenses[:8] %}
            <tr data-expense-id="{{ expense.id }}">
              <td>{{ loop.index }}</td>
              <td>{{ expense.title_expense }}</td>
              <td>{{ format_currency(expense['amount_expense'], expense['currency']) }}</td>
              <td>{{ expense.date_expense }}</td>
              <td>
                <button class="btn btn-danger btn-sm delete-expense" data-id="{{ expense.id }}">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if expenses|length > 8 %}
        <button class="btn btn-primary" onclick="showAllExpenseRecords()">Show All Records</button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Income Modal -->
<div id="allRecordsIncomeModal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="text-primary-income">All Income Records</h5>
      </div>
      <div class="modal-body">
        <div class="table-responsive small">
          <table class="table table-striped table-sm" id="modalTable">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Income</th>
                <th scope="col">Amount</th>
                <th scope="col">Date</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for income in incomes %}
              <tr data-income-id="{{ income.id }}">
                <td>{{ loop.index }}</td>
                <td>{{ income.title_income }}</td>
                <td>{{ format_currency(income['amount_income'], income['currency']) }}</td>
                <td>{{ income.date_income }}</td>
                <td>
                  <button class="btn btn-danger btn-sm delete-income" data-id="{{ income.id }}">Delete</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAllIncomeRecordsModal()">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Expense Modal -->
<div id="allRecordsExpenseModal" class="modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="text-primary-income">All Expenses Records</h5>
      </div>
      <div class="modal-body">
        <div class="table-responsive small">
          <table class="table table-striped table-sm" id="modalTable2">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Expense</th>
                <th scope="col">Amount</th>
                <th scope="col">Date</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for expense in expenses %}
              <tr data-expense-id="{{ expense.id }}">
                <td>{{ loop.index }}</td>
                <td>{{ expense.title_expense }}</td>
                <td>{{ format_currency(expense['amount_expense'], expense['currency']) }}</td>
                <td>{{ expense.date_expense }}</td>
                <td>
                  <button class="btn btn-danger btn-sm delete-expense" data-id="{{ expense.id }}">Delete</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAllExpenseRecordsModal()">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}